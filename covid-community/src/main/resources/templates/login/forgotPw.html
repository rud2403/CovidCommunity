<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CoCo - 비밀번호 찾기</title>

    <!-- Custom fonts for this template-->
    <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="../css/sb-admin-2.min.css" rel="stylesheet">

	<!-- 제이쿼리 적용 -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
</head>

<body class="bg-gradient-primary">

    <div class="container">

        <!-- Outer Row -->
        <div class="row justify-content-center">

            <div class="col-xl-10 col-lg-12 col-md-9">

                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                             <div class="p-5" style="width: 220%">
                                 <div class="text-center">
                                     <h1 class="h4 text-gray-900 mb-2">비밀번호 찾기</h1>
                                     <p class="mb-4">비밀번호를 찾으려는 이메일을 입력해 주세요.</p>
                                 </div>
                                 <form class="user" th:action="@{/resetPw}" method="post" id="frm">
                                    <div class="form-group row ml-2">
	                                    <input type="email" class="form-control form-control-user col-sm-10 ml-2" id="user_email"
	                                        placeholder="이메일을 입력해주세요." name="userEmail" style="width: 100%">
	                                    <button class="btn btn-secondary btn-sm col-sm-1 ml-3" type="button" id="certiBtn" disabled>인증</button>
	                                </div>
	                                <!-- 인증번호 입력칸 -->
	                                <div class="form-group row ml-2" id="certiSec" style="display:none;">
	                                    <input type="text" class="form-control form-control-user col-sm-10 ml-2" id="certi_num"
	                                        placeholder="인증번호" style="width: 100%">
	                                </div>
                                 </form>
                                 <button class="btn btn-primary btn-user btn-block ml-3" style="width: 95%" id="certiConBtn" disabled>
                                         확인
                                 </button>
                                 <hr>
                                 <div class="text-center">
                                     <a class="small" href="register.html">Create an Account!</a>
                                 </div>
                                 <div class="text-center">
                                     <a class="small" href="login.html">Already have an account? Login!</a>
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>
	<script>
		$(document).ready(function(){
			// 이메일 유효성 체크 시작
			$("#user_email").keyup(function(){
				
				console.log('이메일 값 입력');
				
				let userEmail = $("#user_email").val();
				
				// 이메일 유효성검사
				let emailVal = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/;
				
				// 이메일 유효성이 맞을 때 
				if(emailVal.test(userEmail)){
					$('#certiBtn').attr("disabled", false);
					
				} else {
					$('#certiBtn').attr("disabled", true);
				}
			});
			// 이메일 유효성 끝
			
			// 인증버튼 클릭 시작
			$('#certiBtn').click(function(){
				
				console.log('인증버튼 클릭');
				
				let userEmail = $("#user_email").val();
				
				$.ajax({
					type : 'POST',
					url : 'register/api/certiEmail',
					data : userEmail,
					dataType :'json',
					contentType: "application/json; charset=UTF-8",
					success : function(data) {
						console.log("data.key :: ", data.key);
						
						$('#certiConBtn').click(function(){
							console.log('확인 클릭');
							
							// 인증 키 값이 일치할 경우
							if(data.key == $('#certi_num').val()){
								
								alert('인증 되었습니다.');
								$('#frm').submit();
								
							// 인증 키 값이 다를 경우
							} else {
								alert('인증번호가 일치하지 않습니다.');
							}
							
						});
						
		            },
		            error : function(error) {
		            	console.log("error :: ", error);
		            }
				});
				
			alert("인증번호가 전송되었습니다.") 
			$('#certiSec').show();
			
			});
			// 인증버튼 클릭 끝
			
			// 인증번호 키 업 시작
			$('#certi_num').keyup(function(){
				if($('#certi_num').val() != ""){
					$('#certiConBtn').attr("disabled", false);
				} else {
					$('#certiConBtn').attr("disabled", true);
				}
			})
			// 인증번호 키 업 끝
		});
	</script>
    <!-- Bootstrap core JavaScript-->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="../js/sb-admin-2.min.js"></script>

</body>

</html>