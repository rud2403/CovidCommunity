<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.coco.project.admin.AdminMapper">

	<!-- 관리자페이지 - 유저정보 리스트 -->
	<select id="userList" resultType="hashmap">
		SELECT
			u_id 		AS uId,
			u_email 	AS uEmail,
			u_social 	AS uSocial,
			u_pw 		AS uPw,
			u_nickname 	AS uNickName,
			u_birth 	AS uBirth,
			u_addr 		AS uAddr,
			u_role 		AS uRole,
			u_regDate 	AS uRegDate,
			u_enabled 	AS uEnabled
		FROM
			user_info ui
		<where>
			<if test="inputVal != null and inputVal != ''">
				<if test="selectVal == 'email'">
					AND u_email LIKE CONCAT('%', #{inputVal}, '%')
				</if>
				<if test="selectVal == 'nickName'">
					AND u_nickName LIKE CONCAT('%', #{inputVal}, '%')
				</if>
			</if>
		</where>
		ORDER by
			u_regDate DESC
		LIMIT
			10 OFFSET ${startRow};
	</select>
	
	<!-- 관리자페이지 - 유저리스트 총 개수 -->
	<select id="userListCnt" resultType="int">
		SELECT
			count(*)	AS totalCnt
		FROM
			user_info
	</select>
	
	<!-- 관리자페이지 - 유저정보 수정 -->
	<update id="userUpdate">
		UPDATE
			user_info
	   SET
	   		u_role = #{userRole},
	   		u_enabled = #{userEnabled}
	   		<if test="userPw != null and userPw !=''">,u_pw = #{userPw}</if>
	      	<if test="userNickName != null and userNickName !=''">,u_nickname = #{userNickName}</if>
	      	<if test="userBirth != null and userBirth !=''">,u_birth = #{userBirth}</if>
	      	<if test="userAddr != null and userAddr !=''">,u_addr = #{userAddr}</if>
		WHERE
			u_id = #{userId}
	</update>
	
	<!-- 관리자페이지 - 게시글정보 리스트 -->
	<select id="boardList" resultType="hashmap">
		SELECT
			rb_id 				AS rbId,
			rb_title 			AS rbTitle,
			rb_content 			AS rbContent,
			rb_view_cnt 		AS rbViewCnt,
			rb_register_date 	AS rbRegisterDate, 
			rb_update_date 		AS rbUpdateDate, 
			rb_writer 			AS rbWriter,
			rb_notice_yn 		AS rbNoticeYn,
			rb_vaccine_kind		AS rbVaccineKind, 
			rb_delete_yn 		AS rbDeleteYn,
			u_nickname			AS uNickName,
			(SELECT
				count(*)
			FROM
				review_like
			WHERE
				rl_board = rbId)		AS rbLikeCnt,
			(SELECT
				count(*)
			FROM
				review_comment
			WHERE
				rc_board = rbId AND rc_delete_yn = 'N')		AS rbCmtCnt
		FROM
			review_board rb
		JOIN
			user_info ui ON rb.rb_writer = ui.u_id
		<where>
			<if test="inputVal != null and inputVal != ''">
				<if test="selectVal == 'title'">
					AND rb_title LIKE CONCAT('%', #{inputVal}, '%')
				</if>
				<if test="selectVal == 'writer'">
					AND u_nickname LIKE CONCAT('%', #{inputVal}, '%')
				</if>
			</if>
		</where>
		ORDER BY
			rb_register_date DESC
		LIMIT
			10 OFFSET ${startRow}
	</select>
	
	<!-- 관리자페이지 - 게시글리스트 총 개수 -->
	<select id="boardListCnt" resultType="int">
		SELECT
			count(*)	AS totalCnt
		FROM
			review_board
	</select>
	
</mapper>